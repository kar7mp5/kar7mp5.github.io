<div style="width:100%;">
  <h2 style="margin-top:0; font-size:1.2em;">방문자수 (최근 30일)</h2>
  <canvas id="visitor-graph" width="320" height="120"
    style="width:100%; max-width:340px; margin-bottom:1em; background:#fff; border:1px solid #eee; border-radius:8px;"></canvas>
  <table id="visitor-table" style="width:100%; border-collapse:collapse; font-size:1em; margin-bottom:2em;">
    <thead>
      <tr style="background:#f8f8f8;">
        <th style="padding:0.5em; text-align:left;">날짜</th>
        <th style="padding:0.5em; text-align:right;">방문수</th>
      </tr>
    </thead>
    <tbody>
      <!-- JS로 채움 -->
    </tbody>
  </table>
</div>
<script>
  // 날짜별 방문자수(localStorage) + 최근 30일 꺾은선 그래프
  (function () {
    var key = 'kar7mp5_blog_visitor_by_date';
    var today = new Date().toISOString().slice(0, 10);
    var data = localStorage.getItem(key);
    data = data ? JSON.parse(data) : {};
    data[today] = (data[today] || 0) + 1;
    localStorage.setItem(key, JSON.stringify(data));
    // 최근 30일만 추출
    var dates = Object.keys(data).sort();
    var last30 = dates.slice(-30);
    var values = last30.map(function (d) { return data[d]; });
    // 표 채우기
    var tbody = document.querySelector('#visitor-table tbody');
    if (tbody) {
      tbody.innerHTML = '';
      last30.slice().reverse().forEach(function (date) {
        var tr = document.createElement('tr');
        var td1 = document.createElement('td');
        var td2 = document.createElement('td');
        td1.textContent = date;
        td2.textContent = data[date].toLocaleString();
        td2.style.textAlign = 'right';
        tr.appendChild(td1); tr.appendChild(td2);
        tbody.appendChild(tr);
      });
    }
    // 꺾은선 그래프 그리기 (티스토리 스타일)
    var canvas = document.getElementById('visitor-graph');
    if (canvas && canvas.getContext) {
      var ctx = canvas.getContext('2d');
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      var W = canvas.width, H = canvas.height;
      var left = 32, right = 10, top = 18, bottom = 28;
      var N = last30.length;
      var max = Math.max.apply(null, values.concat([1]));
      // 축
      ctx.strokeStyle = '#bbb';
      ctx.lineWidth = 1;
      ctx.beginPath();
      ctx.moveTo(left, top);
      ctx.lineTo(left, H - bottom);
      ctx.lineTo(W - right, H - bottom);
      ctx.stroke();
      // y축 눈금
      ctx.fillStyle = '#888';
      ctx.font = '11px sans-serif';
      for (var i = 0; i <= 4; i++) {
        var y = top + (H - bottom - top) * i / 4;
        var v = Math.round(max * (1 - i / 4));
        ctx.fillText(v, 2, y + 4);
        ctx.strokeStyle = '#eee';
        ctx.beginPath();
        ctx.moveTo(left, y);
        ctx.lineTo(W - right, y);
        ctx.stroke();
      }
      // x축 날짜
      ctx.save();
      ctx.font = '10px sans-serif';
      ctx.fillStyle = '#888';
      ctx.textAlign = 'center';
      for (var i = 0; i < N; i += Math.max(1, Math.floor(N / 7))) {
        var x = left + (W - left - right) * i / (N - 1);
        ctx.fillText(last30[i].slice(5), x, H - bottom + 14);
      }
      ctx.restore();
      // 꺾은선
      ctx.strokeStyle = '#6a4caf';
      ctx.lineWidth = 2;
      ctx.beginPath();
      for (var i = 0; i < N; i++) {
        var x = left + (W - left - right) * i / (N - 1);
        var y = top + (H - bottom - top) * (1 - values[i] / max);
        if (i === 0) ctx.moveTo(x, y);
        else ctx.lineTo(x, y);
      }
      ctx.stroke();
      // 점 + 값
      for (var i = 0; i < N; i++) {
        var x = left + (W - left - right) * i / (N - 1);
        var y = top + (H - bottom - top) * (1 - values[i] / max);
        ctx.beginPath();
        ctx.arc(x, y, 3, 0, 2 * Math.PI);
        ctx.fillStyle = '#6a4caf';
        ctx.fill();
        ctx.font = 'bold 11px sans-serif';
        ctx.fillStyle = '#222';
        ctx.textAlign = 'center';
        ctx.fillText(values[i], x, y - 8);
      }
    }
  })();
</script>